---
layout: post
title: "Implementing PassKeys With Go"
date: 2025-06-19 12:00:00 +0800
tags: []
description: "An introduction to Fixed-Width Binary Encoding, a compact and efficient method of storing structured data in bytes without identifiers."
status: in-progress
---

Passkeys are a great way to offer a more secure form of login to your users.

<!--more-->

### Process

There are two scenarios involved with implementing passkeys. Creation and Validation.

### Creation

Once a users creates a passkey in whatever application has prompted them, a public and private key value pair are created. The private key is stored securely on the users device, while the public key is returned and sent back the server. The server stores the public key against the user record so it can be retrieved later.

### Validation

When a user initiates login with a passkey, the server needs to create a challenge string. A challenge string is a random string of characters signed by private the private key on users device. The signed challenge string gets sent back to the server where the users public key is found, and then used to verify the signature of the challenge string. Once a signature is validated, an authentication token can be issued and sent back to the user.

### Creating a passkey

Requesting a passkey is done with a call to a browser API with a specified payload.

```javascript
const request = async (userId: string, username: string, challenge: string) => {
  try {
    const publicKey = {
      challenge: base64UrlToUint8Array(challenge),
      rp: {
        name: "PassKit Portal",
        id: window.location.hostname,
      },
      user: {
        id: strToUint8Array(userId),
        name: username,
        displayName: "User",
      },
      pubKeyCredParams: [
        { type: "public-key", alg: -7 },
        { type: "public-key", alg: -257 },
      ],
      authenticatorSelection: {
        authenticatorAttachment: "platform",
        residentKey: "required",
        userVerification: "preferred",
        requireResidentKey: true,
      },
      timeout: 60000,
      attestation: "none",
    };

    const credential = await navigator.credentials.create({ publicKey });
  } catch (error) {
    console.error(error);
  }
};
```

Above is a basic passkey challenge request. When initiated, whatever passkey provided the user has on their device will open and prompt them to create a passkey. Once created, a response object will be returned to the browser.

### Saving a passkey record

Before saving a public key, validation must be done on the response generated by the browser.

1. Challenge string matches the one used to create the passkey.
2. The origin of the passkey matches the one used by the request.

Once validation has been passed, extract the public key and save it to your database.
